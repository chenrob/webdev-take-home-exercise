<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asana | Pet Adoption Agency in San Francisco</title>
  <meta name="description" content="Asana is the premier pet adoption agency in San Francisco">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="/assets/app.css">
</head>
<body>
  {% include 'assets/snippets/header.html' %}

  <div class="tiles-container"></div>

  <div class="tile template">
    <img src="" class="dog-picture" />
  </div>

  <div class="modal-overlay">
    <div class="modal">
      <span class="close">&times;</span>

      <img src="" class="dog-picture" />
    </div>
  </div>

  {% include 'assets/snippets/footer.html' %}

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/chenrob/odl-tiles2.1/jquery.tileUI.js"></script>

  <script type="text/javascript">
    (function($) {
      const $body = $('body');
      const $container = $('.tiles-container');
      const $template = $('.tile.template');
      const $modal = $('.modal');
      const $modalImage = $('.modal .dog-picture');

      const dogsAr = [];

      $(document)
        .on('click', '.close, .modal-overlay', function(e) {
          $body.removeClass('overlay');
        })
        .on('click', '.modal', function(e) {
          // prevent closing modal when it's clicked
          e.stopPropagation();
        })
        .on('click', '.tile', function(e) {
          const $tile = $(this);
          const dog = dogsAr[$tile.data('index')];

          $modalImage.attr('src', dog.image);

          $body.addClass('overlay');
        });

      function buildTile(dog, i) {
        const $tile = $template
          .clone()
          .removeClass('template')
          .data('index', i);

        $tile.find('.dog-picture').attr('src', dog.image);

        return $tile;
      };

      $.getJSON('/dogs', function(response) {
        response.dogs.forEach(function(dog) {
          const $tile = buildTile(dog, dogsAr.length);

          dogsAr.push(dog);
          $container.append($tile);
        });

        $container.tileUI();
      });
    })(jQuery);
  </script>
</body>
</html>
